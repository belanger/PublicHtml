<!DOCTYPE html>
<html >
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="hevea 2.32">
<style type="text/css">
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.dd-description{margin:0ex 0ex 1ex 4ex;}
.dt-description{margin:0ex;}
.toc{list-style:none;}
.footnotetext{margin:0ex; padding:0ex;}
div.footnotetext P{margin:0px; text-indent:1em;}
.thefootnotes{text-align:left;margin:0ex;}
.dt-thefootnotes{margin:0em;}
.dd-thefootnotes{margin:0em 0em 0em 2em;}
.footnoterule{margin:1em auto 1em 0px;width:50%;}
.caption{padding-left:2ex; padding-right:2ex; margin-left:auto; margin-right:auto}
.title{margin:2ex auto;text-align:center}
.titlemain{margin:1ex 2ex 2ex 1ex;}
.titlerest{margin:0ex 2ex;}
.center{text-align:center;margin-left:auto;margin-right:auto;}
.flushleft{text-align:left;margin-left:0ex;margin-right:auto;}
.flushright{text-align:right;margin-left:auto;margin-right:0ex;}
div table{margin-left:inherit;margin-right:inherit;margin-bottom:2px;margin-top:2px}
td table{margin:auto;}
table{border-collapse:collapse;}
td{padding:0;}
.cellpadding0 tr td{padding:0;}
.cellpadding1 tr td{padding:1px;}
pre{text-align:left;margin-left:0ex;margin-right:auto;}
blockquote{margin-left:4ex;margin-right:4ex;text-align:left;}
td p{margin:0px;}
.boxed{border:1px solid black}
.textboxed{border:1px solid black}
.vbar{border:none;width:2px;background-color:black;}
.hbar{border:none;height:2px;width:100%;background-color:black;}
.hfill{border:none;height:1px;width:200%;background-color:black;}
.vdisplay{border-collapse:separate;border-spacing:2px;width:auto; empty-cells:show; border:2px solid red;}
.vdcell{white-space:nowrap;padding:0px; border:2px solid green;}
.display{border-collapse:separate;border-spacing:2px;width:auto; border:none;}
.dcell{white-space:nowrap;padding:0px; border:none;}
.dcenter{margin:0ex auto;}
.vdcenter{border:solid #FF8000 2px; margin:0ex auto;}
.minipage{text-align:left; margin-left:0em; margin-right:auto;}
.marginpar{border:solid thin black; width:20%; text-align:left;}
.marginparleft{float:left; margin-left:0ex; margin-right:1ex;}
.marginparright{float:right; margin-left:1ex; margin-right:0ex;}
.theorem{text-align:left;margin:1ex auto 1ex 0ex;}
.part{margin:2ex auto;text-align:center}
.lstlisting{font-family:monospace;white-space:pre;margin-right:auto;margin-left:0pt;text-align:left}
</style>
<script language="javascript"> 
var ua = window.navigator.userAgent;  
var old_ie = ua.indexOf('MSIE ');  
var new_ie = ua.indexOf('Trident/');  
if ((old_ie > -1) || (new_ie > -1) || Boolean(window.chrome)){
 (function () {
  var script = document.createElement("script");
  script.type = "text/javascript";
  script.src  = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML";
  document.getElementsByTagName("head")[0].appendChild(script);
})();
}
</script>
<title>Compiling LATEX to computer algebra-enabled HTML5
</title>
</head>
<body >
<!--HEVEA command line is: /usr/bin/hevea -fix castex.tex -->
<!--CUT STYLE article--><!--CUT DEF section 1 --><p>


<div>
<div id="maindiv" style="max-height: 500px; overflow:auto">


</p><table class="title"><tr><td style="padding:1ex"><h1 class="titlemain">Compiling L<sup>A</sup>T<sub>E</sub>X to computer algebra-enabled HTML5</h1><h3 class="titlerest">Bernard Parisse<br>
Institut Fourier<br>
UMR 5582 du
CNRS<br>
Université de Grenoble I</h3><h3 class="titlerest">2017</h3></td></tr>
</table><blockquote class="abstract"><span style="font-weight:bold">Abstract: </span>
This document explains how to create or modify an
existing L<sup>A</sup>T<sub>E</sub>X document with commands enabling computations in 
the HTML5 output: when the reader opens the HTML5
output, he can run a computation in his browser, or
modify the command to be executed and run it.
This is done by combining different softwares: <code>hevea</code>[<a href="#hevea"></a>]
for compilation to HTML5, <code>giac.js</code> for the CAS computing kernel
(itself compiled from the C++ Giac[<a href="#giac"></a>] library with 
<code>emscripten</code>[<a href="#emscripten"></a>]), and 
a modified version[<a href="#hevea2mml"></a>] of <code>itex2MML</code>[<a href="#itex2mml"></a>] 
for fast and nice rendering in
MathML in browsers that support MathML.
</blockquote><!--TOC section id="sec1" Contents-->
<h2 id="sec1" class="section">Contents</h2><!--SEC END --><ul class="toc"><li class="li-toc">
<a href="#sec3">1  Introduction</a>
</li><li class="li-toc"><a href="#sec4">2  User manual</a>
<ul class="toc"><li class="li-toc">
<a href="#sec5">2.1  Installation on the writer computer</a>
</li><li class="li-toc"><a href="#sec6">2.2  On the writer side</a>
</li><li class="li-toc"><a href="#sec7">2.3  On the reader side</a>
</li><li class="li-toc"><a href="#sec8">2.4  More examples</a>
<ul class="toc"><li class="li-toc">
<a href="#sec9">2.4.1  Trace (2-d graph)</a>
</li><li class="li-toc"><a href="#sec10">2.4.2  Cone section (3-d graph)</a>
</li><li class="li-toc"><a href="#sec11">2.4.3  Dunford decomposition (CAS)</a>
</li><li class="li-toc"><a href="#sec12">2.4.4  Slopefield</a>
</li><li class="li-toc"><a href="#sec13">2.4.5  Gröbner basis (CAS)</a>
</li><li class="li-toc"><a href="#sec14">2.4.6  Logo turtle</a>
</li><li class="li-toc"><a href="#sec15">2.4.7  Fractals</a>
</li></ul>
</li></ul>
</li><li class="li-toc"><a href="#sec16">3  How this is done</a>
</li><li class="li-toc"><a href="#sec17">4  Conclusion</a>
</li></ul><!--TOC section id="sec2" Index-->
<h2 id="sec2" class="section">Index</h2><!--SEC END --><p></p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" ><ul class="indexenv"><li class="li-indexenv">
giaccmd, <a href="#hevea_default9">2.2</a>, <a href="#hevea_default11">2.2</a>
</li><li class="li-indexenv">giaccmdbigmath, <a href="#hevea_default5">2.2</a>, <a href="#hevea_default6">2.2</a>
</li><li class="li-indexenv">giaccmdmath, <a href="#hevea_default2">2.2</a>, <a href="#hevea_default3">2.2</a>
</li><li class="li-indexenv">giachidden, <a href="#hevea_default15">2.2</a>
</li><li class="li-indexenv">giacinput, <a href="#hevea_default7">2.2</a>, <a href="#hevea_default10">2.2</a>
</li><li class="li-indexenv">giacinputbig, <a href="#hevea_default8">2.2</a>
</li><li class="li-indexenv">giacinputbigmath, <a href="#hevea_default4">2.2</a>
</li></ul></td><td style="vertical-align:top;text-align:left;" ><ul class="indexenv"><li class="li-indexenv">giacinputmath, <a href="#hevea_default1">2.2</a>
</li><li class="li-indexenv">giaclink, <a href="#hevea_default16">2.2</a>
</li><li class="li-indexenv">giaconload, <a href="#hevea_default13">2.2</a>
</li><li class="li-indexenv">giacprog, <a href="#hevea_default12">2.2</a>
</li><li class="li-indexenv">giacslider, <a href="#hevea_default14">2.2</a>
<br>
<br>
</li><li class="li-indexenv">install, <a href="#hevea_default0">2.1</a>
</li></ul></td></tr>
</table>
<!--TOC section id="sec3" Introduction-->
<h2 id="sec3" class="section">1  Introduction</h2><!--SEC END --><p>
Combining L<sup>A</sup>T<sub>E</sub>X rendering quality and CAS computing is not new:
</p><ol class="enumerate" type=1><li class="li-enumerate">
math softwares provide converters to export data to a L<sup>A</sup>T<sub>E</sub>X file,
or provide automated computations in a way similar 
to the way bibtex provides bibliography, like sagetex ([<a href="#sagetex"></a>]).
</li><li class="li-enumerate">some softwares handle both L<sup>A</sup>T<sub>E</sub>X-like rendering and
computation, for example texmacs ([<a href="#texmacs"></a>]), lyx ([<a href="#lyx"></a>]), 
Jupyter notebook ([<a href="#jupyter"></a>]). 
</li></ol><p>
However, in the first case,
the reader can not modify the CAS commandlines, and in the second
case the data format is not standard L<sup>A</sup>T<sub>E</sub>X (the writer can not
start from an existing document)
and requires additional software to be installed on
the reader device or a net access to a server 
to run the computations.</p><p>The solution presented here is new in that the writer will edit
a standard L<sup>A</sup>T<sub>E</sub>X file, add a few easy to learn commands like
<code>\giacinputmath{factor(x^10-1)}</code> or <code>\giacinput{plot(sin(x))}</code>
and compile it to produce a HTML5+MathML
document. 
The reader can see the document in any browser 
(it’s optimized for Firefox), without installation, and he can 
modify computation commandlines
and run them on his own computer.</p><p>If you are reading this file in PDF format, it is highly recommended to
open 
<a href="https://www-fourier.ujf-grenoble.fr/~parisse/giac/castex.html">the HTML5/Mathml version</a>
in order to test interactivity
and look at the L<sup>A</sup>T<sub>E</sub>X 
<a href="https://www-fourier.ujf-grenoble.fr/~parisse/giac/castex.tex">source</a></p>
<!--TOC section id="sec4" User manual-->
<h2 id="sec4" class="section">2  User manual</h2><!--SEC END -->
<!--TOC subsection id="sec5" Installation on the writer computer-->
<h3 id="sec5" class="subsection">2.1  Installation on the writer computer</h3><!--SEC END --><p>
The writer must install 
</p><ul class="itemize"><li class="li-itemize">
version 2.30 (or greater) 
of <a href="http://hevea.inria.fr/"><span style="font-family:monospace">hevea</span></a> 
([<a href="#hevea"></a>])
or a forked version 
<a href="https://github.com/YannickChevalier/hevea-mathjax"><span style="font-family:monospace">hevea-mathjax</span></a> ([<a href="#heveamathjax"></a>])),
</li><li class="li-itemize"><a href="https://www-fourier.ujf-grenoble.fr/~parisse/giac.html"><span style="font-family:monospace">Giac/Xcas</span></a> ([<a href="#giac"></a>]) 
for computing-enabled output
</li><li class="li-itemize"><a href="https://www-fourier.ujf-grenoble.fr/~parisse/giac/heveatomml.tgz"><span style="font-family:monospace">heveatomml</span></a> ([<a href="#hevea2mml"></a>]) 
for MathML output
</li></ul><p>
The files 
<a href="https://www-fourier.ujf-grenoble.fr/~parisse/giac/giac.tex"><span style="font-family:monospace">giac.tex</span></a> (or the French version
<a href="https://www-fourier.ujf-grenoble.fr/~parisse/giac/giacfr.tex"><span style="font-family:monospace">giacfr.tex</span></a>)
<a href="https://www-fourier.ujf-grenoble.fr/~parisse/giac.js"><span style="font-family:monospace">giac.js</span></a>, 
<a href="https://www-fourier.ujf-grenoble.fr/~parisse/giacwasm.js"><span style="font-family:monospace">giacwasm.js</span></a>, 
<a href="https://www-fourier.ujf-grenoble.fr/~parisse/giacwasm.wasm"><span style="font-family:monospace">giacwasm.wasm</span></a>, 
<a href="https://www-fourier.ujf-grenoble.fr/~parisse/giac/hevea.sty"><span style="font-family:monospace">hevea.sty</span></a>, 
<a href="https://www-fourier.ujf-grenoble.fr/~parisse/giac/mathjax.sty"><span style="font-family:monospace">mathjax.sty</span></a> must
be copied in the L<sup>A</sup>T<sub>E</sub>X working directory.
On an Internet connected linux box, the writer can run once
the following shell script to install<a id="hevea_default0"></a> the tools required 
for HTML5/MathML output :
</p><pre class="verbatim">#! /bin/bash
wget https://www-fourier.ujf-grenoble.fr/~parisse/giac/giac.tex
wget https://www-fourier.ujf-grenoble.fr/~parisse/giac/giacfr.tex
wget https://www-fourier.ujf-grenoble.fr/~parisse/giac/giac.js
wget https://www-fourier.ujf-grenoble.fr/~parisse/giac/giacwasm.js
wget https://www-fourier.ujf-grenoble.fr/~parisse/giac/giacwasm.wasm
wget https://www-fourier.ujf-grenoble.fr/~parisse/giac/hevea.sty
wget https://www-fourier.ujf-grenoble.fr/~parisse/giac/mathjax.sty
wget http://hevea.inria.fr/distri/hevea-2.31.tar.gz
tar xvfz hevea-2.31.tar.gz
cd hevea-2.31
make
sudo make install
cd ..
wget https://www-fourier.ujf-grenoble.fr/~parisse/giac/heveatomml.tgz
tar xvfz heveatomml.tgz
cd heveatomml/src
make
sudo make install
cd ../..
</pre>
<!--TOC subsection id="sec6" On the writer side-->
<h3 id="sec6" class="subsection">2.2  On the writer side</h3><!--SEC END --><p>
We now assume that the installation is done.
The writer opens a L<sup>A</sup>T<sub>E</sub>X file with his usual editor. He must add in
the preamble the following lines
</p><pre class="verbatim">\makeindex
\input{giac.tex}
\giacmathjax
</pre><p>
For interactive CAS L<sup>A</sup>T<sub>E</sub>X commands support,
the writer should add 
</p><pre class="verbatim">\begin{giacjshere}
\tableofcontents
\printindex
</pre><p>
just after <code>\begin{document}</code> and 
</p><pre class="verbatim">\end{giacjshere}
</pre><p>
just before <code>\end{document}</code>.
Printing the table of contents and index before the first L<sup>A</sup>T<sub>E</sub>X
section command is recommended, otherwise the HTML output
<code>Table</code> and <code>Index</code> buttons will not link correctly.</p><p>The rest of the source file is standard L<sup>A</sup>T<sub>E</sub>X except that
</p><ul class="itemize"><li class="li-itemize">
References to numbered equations should be inside additional 
backslash-ed parenthesis, for example

<tt>
\begin{equation} \label{eq_test}
 \frac{2}{x^2-1}=\frac{1}{x-1}-\frac{1}{x+1} 
\end{equation}
From equation (\(eq_test\)) ...
</tt>
<a id="eqref_1"></a><math xmlns='http://www.w3.org/1998/Math/MathML' display='block'><semantics><mrow><mfrac><mn>2</mn><mrow><msup><mi>x</mi> <mn>2</mn></msup><mo>&minus;</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mrow><mi>x</mi><mo>&minus;</mo><mn>1</mn></mrow></mfrac><mo>&minus;</mo><mfrac><mn>1</mn><mrow><mi>x</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mspace width="2em"/><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding='application/x-tex'> 
 \frac{2}{x^2&#x2d;1}=\frac{1}{x&#x2d;1}&#x2d;\frac{1}{x+1} 
\qquad (1) </annotation></semantics></math>
From equation (<a href="#eqref_1">1</a>) ...
</li><li class="li-itemize"><code>\mathbb{}</code> should be explicit, commands like
<code>\R</code> where <code>\R</code> is defined
by <code>\newcommand{\R}{\mathbb{R}}</code> will not work.
</li><li class="li-itemize">New commands are available for interactive CAS support
<ul class="itemize"><li class="li-itemize">
<code>\giacinputmath{commandline}</code><a id="hevea_default1"></a> will output 
an inline
<code>commandline</code> 
that the user can modify and execute, the answer will be displayed
in MathML (or SVG for 2-d graph output).<br>
Example : <code>\giacinputmath{factor(x^10-1)}</code><br>
<br><textarea onkeypress="UI.ckenter(event,this,2)" 
style="width:400px;font-size:large">factor(x^10-1) 
</textarea><button onclick="previousSibling.style.display='inherit';var tmp=UI.caseval(previousSibling.value); tmp=UI.latexeval(tmp);nextSibling.innerHTML='&nbsp;'+tmp; if (UI.usemathjax) MathJax.Hub.Queue(['Typeset',MathJax.Hub,nextSibling])">ok</button><span></span><br>
<br>
<span style="font-weight:bold">Warnings</span>, if your command contains <code>&lt;</code> or <code>&gt;</code>, you must
replace them by <code>&amp;lt;</code> or <code>&amp;gt;</code>, 
otherwise they will be interpreted as HTML delimiters. You can also
use the <code>giacprog</code> and <code>giaconload</code> environments explained below.<br>
If the output 
is a 2-d graph, do not skip a line with <code>\\</code> after the command 
for PDF output
</li><li class="li-itemize"><code>\giaccmdmath{command}{arguments}</code><a id="hevea_default2"></a> 
will output <code>command</code> in a button following the <code>arguments</code>, 
the reader can only modify the arguments:<br>
<code>\giaccmdmath{factor}{x^4-1}</code><a id="hevea_default3"></a><br>
<br><textarea 
style="width:400px;font-size:large">x^4-1
</textarea><button onclick="var tmp=UI.caseval( 
'factor('+
previousSibling.value+')');  tmp=UI.latexeval(tmp);nextSibling.innerHTML='&nbsp;'+tmp; if (UI.usemathjax) MathJax.Hub.Queue(['Typeset',MathJax.Hub,nextSibling]);
">
factor
</button><span></span><br>
<br>
</li><li class="li-itemize">These commands may take an optional HTML style argument, for example<br>
<code>\giacinputmath[style="width:200px;"]{factor(x^10-1)}</code><br>
<br><textarea onkeypress="UI.ckenter(event,this,2)" 
style="width:200px;">factor(x^10-1) 
</textarea><button onclick="previousSibling.style.display='inherit';var tmp=UI.caseval(previousSibling.value); tmp=UI.latexeval(tmp);nextSibling.innerHTML='&nbsp;'+tmp; if (UI.usemathjax) MathJax.Hub.Queue(['Typeset',MathJax.Hub,nextSibling])">ok</button><span></span><br>
<br>
<code>\giaccmdmath[style="font-size:x-large"]{factor}{x^4-1}</code><br>
<br><textarea 
style="font-size:x-large">x^4-1
</textarea><button onclick="var tmp=UI.caseval( 
'factor('+
previousSibling.value+')');  tmp=UI.latexeval(tmp);nextSibling.innerHTML='&nbsp;'+tmp; if (UI.usemathjax) MathJax.Hub.Queue(['Typeset',MathJax.Hub,nextSibling]);
">
factor
</button><span></span><br>
<br>
</li><li class="li-itemize">There are similar commands for outlined output
<code>\giacinputbigmath{}</code><a id="hevea_default4"></a> 
or <code>\giaccmdbigmath{}{}</code><a id="hevea_default5"></a>:<br>
For example <code>\giacinputbigmath{factor(x^25-1)}</code><br>
<div><textarea onkeypress="UI.ckenter(event,this,2)" 
style="width:800px;font-size:large">factor(x^25-1) 
</textarea><button onclick="previousSibling.style.display='inherit';var tmp=UI.caseval(previousSibling.value); tmp=UI.latexeval(tmp);nextSibling.innerHTML=tmp; if (UI.usemathjax) MathJax.Hub.Queue(['Typeset',MathJax.Hub,nextSibling])">ok</button><div style="width:800px;max-height:200px;overflow:auto;color:blue;text-align:center"></div></div>
<br>
Example with an optional style argument 
<code>\giacinputbigmath[style="width:600px;height:20px;"]{factor(x^25-1)}</code><br>
<div><textarea onkeypress="UI.ckenter(event,this,2)" 
style="width:600px;height:20px;">factor(x^25-1) 
</textarea><button onclick="previousSibling.style.display='inherit';var tmp=UI.caseval(previousSibling.value); tmp=UI.latexeval(tmp);nextSibling.innerHTML=tmp; if (UI.usemathjax) MathJax.Hub.Queue(['Typeset',MathJax.Hub,nextSibling])">ok</button><div style="width:800px;max-height:200px;overflow:auto;color:blue;text-align:center"></div></div>
<br>
<code>\giaccmdbigmath{factor}{x^25-1}</code><a id="hevea_default6"></a><br>
<br><textarea 
style="width:800px;font-size:large">x^25-1 
</textarea><button onclick="var tmp=UI.caseval( 
'factor('+
previousSibling.value+')');  tmp=UI.latexeval(tmp);nextSibling.innerHTML=tmp; if (UI.usemathjax) MathJax.Hub.Queue(['Typeset',MathJax.Hub,nextSibling])">
factor
</button><div style="width:800px;max-height:200px;overflow:auto;color:blue;text-align:center"></div><br>
<br>
<code>\giaccmdbigmath[style="width:600px;height:20px;"]{factor}{x^25-1}</code><br>
<br><textarea 
style="width:600px;height:20px;">x^25-1 
</textarea><button onclick="var tmp=UI.caseval( 
'factor('+
previousSibling.value+')');  tmp=UI.latexeval(tmp);nextSibling.innerHTML=tmp; if (UI.usemathjax) MathJax.Hub.Queue(['Typeset',MathJax.Hub,nextSibling])">
factor
</button><div style="width:800px;max-height:200px;overflow:auto;color:blue;text-align:center"></div><br>

</li><li class="li-itemize">Similar commands with text (or plot) output 
<code>\giacinput</code><a id="hevea_default7"></a> and <code>\giacinputbig</code><a id="hevea_default8"></a> and
<code>\giaccmd</code><a id="hevea_default9"></a>, 
example:<br>
<code>\giacinput{factor(x^4-1)}</code><a id="hevea_default10"></a> :<br>

<textarea onkeypress="UI.ckenter(event,this,1)" 
style="width:400px;font-size:large">factor(x^4-1)
</textarea><button onclick="previousSibling.style.display='inherit';var tmp=UI.caseval(previousSibling.value);tmp=UI.rmquote(tmp); nextSibling.innerHTML='&nbsp;'+tmp;UI.render_canvas(nextSibling);">ok</button><span></span><br>
<br>
<code>\giaccmd{print}{"Hello world"}</code><a id="hevea_default11"></a> :<br>

<textarea
style="width:400px;font-size:large">"Hello world"
</textarea><button onclick="var tmp=UI.caseval(
'print('
+previousSibling.value+')');tmp=UI.rmquote(tmp); nextSibling.innerHTML='&nbsp;'+tmp;UI.render_canvas(nextSibling)">
print
</button><span></span><br>
<br>
With optional style argument<br>
<code>\giacinput[style="font-size:x-large"]{plot(1/x)}</code><br>

<textarea onkeypress="UI.ckenter(event,this,1)" 
style="font-size:x-large">plot(1/x)
</textarea><button onclick="previousSibling.style.display='inherit';var tmp=UI.caseval(previousSibling.value);tmp=UI.rmquote(tmp); nextSibling.innerHTML='&nbsp;'+tmp;UI.render_canvas(nextSibling);">ok</button><span></span><br>

<code>\giaccmd[style="font-size:x-large"]{factor}{x^4-1}</code><br>

<textarea
style="font-size:x-large">x^4-1
</textarea><button onclick="var tmp=UI.caseval(
'factor('
+previousSibling.value+')');tmp=UI.rmquote(tmp); nextSibling.innerHTML='&nbsp;'+tmp;UI.render_canvas(nextSibling)">
factor
</button><span></span><br>
<br>

</li><li class="li-itemize">The <code>giacprog</code><a id="hevea_default12"></a> environment should be used for programs or multi-line commands<br>
<code>\begin{giacprog}...\end{giacprog}</code><br>
Inside this environment, you can keep <code>&lt;</code> and <code>&gt;</code>. The
program will be parsed once the user press the <code>ok</code> button. After
parse, the program may be modified and parsed again.<br>
<span style="font-weight:bold">Warning</span>: Do not use the <code>giacprog</code> environment in another environment (like itemize or
enumerate).<br>
If you want the program to be parsed at load-time, replace
<code>giacprog</code> with <code>giaconload</code><a id="hevea_default13"></a>:<br>
<code>\begin{giaconload}...\end{giaconload}</code>
</li><li class="li-itemize">The <code>\giacslider{idname}{min}{max}{step}{value}{command}</code> 
command will add
a slider. When the user modifies the slider interactively, the new
<code>value</code> is stored in <code>idname</code> and the <code>command</code> 
(depending on <code>idname</code>)
is executed. Example:<br>
<code>\giacslider{a}{-5}{5}{0.1}{0.5}{plot(sin(a*x))}</code><a id="hevea_default14"></a><br>


<div><form onsubmit="setTimeout(function(){UI.eval_form(form);});return false;">
<input type="text" name="name" size="1" value=

"a">

=<input type="number" name="valname" onchange="UI.eval_form(form);" value=

"0.5">

<input type="button" value="-" onclick="valname.value -= stepname.value;UI.eval_form(form);">
<input type="button" value="+" onclick="valname.value -= -stepname.value;UI.eval_form(form);">
<input type="number" name="stepname" value=

"0.1">

<input type="range" name="rangename"
onclick="valname.value=value;UI.eval_form(form);" value=

"0.5" min="-5" max="5" step="0.1">

<textarea name="prog" onchange="UI.eval_form(form)" style="width:400px;vertical-align:bottom;font-size:large">
plot(sin(a*x))

</textarea>
</form>
<span>Not evaled</span></div>

</li><li class="li-itemize">The <code>\giachidden</code><a id="hevea_default15"></a> command behaves like
<code>\giaccmd</code> except that the default HTML5 style is “hidden”
until the command button has been pressed.</li><li class="li-itemize">The <code>\giaclink</code><a id="hevea_default16"></a> command will add a link in the
HTML version and nothing in PDF/DVI. The links open in a new tab, and the
corresponding text may be specified as optional argument (default 
is Test online). Note that <code>hevea.sty</code> provides similar commands
(<code>\ahref</code>, <code>\footahref</code>, <code>\ahrefurl</code>) 
with output in PDF/DVI.<br>
Example with a link to Xcas for Firefox with a few commands<br>
<code>\giaclink{http://www-fourier.ujf-grenoble.fr/\%7eparisse/xcasen.html#+factor(x^4-1)&amp;+a:=idn(3)&amp;}</code><br>
<a href="http://www-fourier.ujf-grenoble.fr/%7eparisse/xcasen.html#+factor(x^4-1)&+a:=idn(3)&"
 target="_blank">
Test online
</a>

</li></ul>
</li></ul><p>Once the source file is written, it is compiled to HTML5 with the command<br>
<code>hevea2mml sourcefile.tex</code><br>
The HTML output and the <code>giac.js</code> files should be in the same
directory on the web server.
Index and bibliography should be processed with <code>makeindex</code>
and <code>bibhva</code>.</p><p>If a PDF output is desired,
the command <code>icas</code> from a Giac/Xcas installation
should be used
instead of <code>pdflatex</code> 
because it will run all CAS commands, output them in a temporary
L<sup>A</sup>T<sub>E</sub>X file, 
and run <code>pdflatex</code> on the output 
(this was inspired by the 
<a href="http://melusine.eu.org/syracuse/giac/pgiac/">pgiac script</a> 
from Jean-Michel Sarlat [<a href="#pgiac"></a>]). The temporary file name
is obtained by adding a <span style="font-family:monospace">_ </span> at the end of the initial file name
(without the <span style="font-family:monospace">.tex</span> extension). Therefore, if you have 
an index and or citations, you should run <code>makeindex</code> and <code>bibtex</code>
on the file name with <code>_</code> appended. For <code>bibtex</code> citations in
the HTML files, you should run <code>bibhva</code>.
For example, the PDF version of this document is available
<a href="https://www-fourier.ujf-grenoble.fr/~parisse/giac/castex.pdf">here</a>.</p>
<!--TOC subsection id="sec7" On the reader side-->
<h3 id="sec7" class="subsection">2.3  On the reader side</h3><!--SEC END --><p>
The reader’s browser opens an HTML5+MathML file (linking to the JavaScript
<code>giac.js</code>). The MathML is rendered natively on Firefox or Safari,
while Chrome or Internet Explorer will automatically load MathJax to
render MathML (this is of course noticeably slower if the document is
large).
Computations are run by the reader’s browser (the CAS is JavaScript
code). This is slower than native code but faster than net access to
a server and it does not require setting up a specific server for
computations.</p>
<!--TOC subsection id="sec8" More examples-->
<h3 id="sec8" class="subsection">2.4  More examples</h3><!--SEC END -->
<!--TOC subsubsection id="sec9" Trace (2-d graph)-->
<h4 id="sec9" class="subsubsection">2.4.1  Trace (2-d graph)</h4><!--SEC END --><p>
This example illustrates with a slider that the evolute of a curve 
is the envelope of the normals to the curve, here the curve is an ellipsis
and the envelop an astroid. 
The list of normals <code>L</code> is initialized empty at load-time.

</p><pre class="verbatim">L:=[]</pre><p> 
<button onclick="var field=parentNode.previousSibling; var tmp=field.innerHTML;if(tmp.length==0) tmp=field.value;var t=createElement('TEXTAREA');t.style.fontSize=20;t.cols=60;t.rows=UI.count_newline(tmp);var tmp1=UI.ltgt(tmp)[0];t.value=tmp1;tmp=UI.caseval(tmp);tmp=UI.rmquote(tmp);nextSibling.innerHTML=tmp; UI.render_canvas(nextSibling); field.parentNode.insertBefore(t,field);field.parentNode.removeChild(field);">ok</button><span>onload</span><br>


Now move the slider:


<div><form onsubmit="setTimeout(function(){UI.eval_form(form);});return false;">
<input type="text" name="name" size="1" value=

"t0">

=<input type="number" name="valname" onchange="UI.eval_form(form);" value=

"0.7">

<input type="button" value="-" onclick="valname.value -= stepname.value;UI.eval_form(form);">
<input type="button" value="+" onclick="valname.value -= -stepname.value;UI.eval_form(form);">
<input type="number" name="stepname" value=

"0.1">

<input type="range" name="rangename"
onclick="valname.value=value;UI.eval_form(form);" value=

"0.7" min="-5" max="5" step="0.1">

<textarea name="prog" onchange="UI.eval_form(form)" style="width:400px;vertical-align:bottom;font-size:large">
gl_x=-6..6;gl_y=-4..4;G:=plotparam([2*cos(t),sin(t)],t=0..2*pi);M:=element(G,evalf(t0));T:=tangent(M);N:=perpendicular(M,T);L:=append(L,N);evolute(G,color=red)

</textarea>
</form>
<span>Not evaled</span></div>

</p>
<!--TOC subsubsection id="sec10" Cone section (3-d graph)-->
<h4 id="sec10" class="subsubsection">2.4.2  Cone section (3-d graph)</h4><!--SEC END --><p>
<math xmlns='http://www.w3.org/1998/Math/MathML' display='inline'><semantics><mrow><mi>C</mi></mrow><annotation encoding='application/x-tex'>C</annotation></semantics></math> is a cone of center the origin, axis of direction <math xmlns='http://www.w3.org/1998/Math/MathML' display='inline'><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding='application/x-tex'>(0,0,1)</annotation></semantics></math>, and angle
<math xmlns='http://www.w3.org/1998/Math/MathML' display='inline'><semantics><mrow><mfrac><mi>&pi;</mi><mn>6</mn></mfrac></mrow><annotation encoding='application/x-tex'>\frac{\pi}{6}</annotation></semantics></math>, <math xmlns='http://www.w3.org/1998/Math/MathML' display='inline'><semantics><mrow><mi>P</mi></mrow><annotation encoding='application/x-tex'>P</annotation></semantics></math> is a plane of equation <math xmlns='http://www.w3.org/1998/Math/MathML' display='inline'><semantics><mrow><mi>z</mi><mo>=</mo><mi>m</mi><mi>y</mi><mo>+</mo><mn>3</mn></mrow><annotation encoding='application/x-tex'>z=my+3</annotation></semantics></math>. 
<math xmlns='http://www.w3.org/1998/Math/MathML' display='inline'><semantics><mrow><mi>m</mi></mrow><annotation encoding='application/x-tex'>m</annotation></semantics></math> is controlled by the slider, when <math xmlns='http://www.w3.org/1998/Math/MathML' display='inline'><semantics><mrow><mi>m</mi></mrow><annotation encoding='application/x-tex'>m</annotation></semantics></math> moves the intersection 
is an ellipsis or hyperbola (limit value is a parabola).


<div><form onsubmit="setTimeout(function(){UI.eval_form(form);});return false;">
<input type="text" name="name" size="1" value=

"m">

=<input type="number" name="valname" onchange="UI.eval_form(form);" value=

"0.7">

<input type="button" value="-" onclick="valname.value -= stepname.value;UI.eval_form(form);">
<input type="button" value="+" onclick="valname.value -= -stepname.value;UI.eval_form(form);">
<input type="number" name="stepname" value=

"0.1">

<input type="range" name="rangename"
onclick="valname.value=value;UI.eval_form(form);" value=

"0.7" min="-5" max="5" step="0.1">

<textarea name="prog" onchange="UI.eval_form(form)" style="width:400px;vertical-align:bottom;font-size:large">

C:=cone([0,0,0],[0,0,1],pi/6, display=green+filled);
P:=plane(z=evalf(m)*y+3,display=cyan+filled);


</textarea>
</form>
<span>Not evaled</span></div>

</p>
<!--TOC subsubsection id="sec11" Dunford decomposition (CAS)-->
<h4 id="sec11" class="subsubsection">2.4.3  Dunford decomposition (CAS)</h4><!--SEC END --><p>
A program computing the Dunford decomposition
of a matrix with Newton method. 
It is parsed at load-time (<code>giaconload</code> environment).

</p><pre class="verbatim">function dunford(A)
  local U,p,q,q1,j,d,n;
  U:=A;
  n:=nrows(U);
  p:=charpoly(U);
  q:=p/gcd(p,p'); // square free part
  q1:=q';
  for (j:=1;j&lt;=n;j:=2*j){
    d:=inv(horner(q1,U))*horner(q,U); // Newton step
    if (d==0*d) return U,A-U;
    U:=U-d;
  }
  return U,A-U;
end:;
</pre><p> 
<button onclick="var field=parentNode.previousSibling; var tmp=field.innerHTML;if(tmp.length==0) tmp=field.value;var t=createElement('TEXTAREA');t.style.fontSize=20;t.cols=60;t.rows=UI.count_newline(tmp);var tmp1=UI.ltgt(tmp)[0];t.value=tmp1;tmp=UI.caseval(tmp);tmp=UI.rmquote(tmp);nextSibling.innerHTML=tmp; UI.render_canvas(nextSibling); field.parentNode.insertBefore(t,field);field.parentNode.removeChild(field);">ok</button><span>onload</span><br>


Example : we define <math xmlns='http://www.w3.org/1998/Math/MathML' display='inline'><semantics><mrow><mi>J</mi></mrow><annotation encoding='application/x-tex'>J</annotation></semantics></math> an almost diagonal matrix and <math xmlns='http://www.w3.org/1998/Math/MathML' display='inline'><semantics><mrow><mi>A</mi></mrow><annotation encoding='application/x-tex'>A</annotation></semantics></math> a similar matrix
and we check the Dunford decomposition of <math xmlns='http://www.w3.org/1998/Math/MathML' display='inline'><semantics><mrow><mi>A</mi></mrow><annotation encoding='application/x-tex'>A</annotation></semantics></math>.
<math xmlns='http://www.w3.org/1998/Math/MathML' display='block'><semantics><mrow><mi>J</mi><mo>=</mo><mrow><mo>(</mo><mtable displaystyle="false" rowspacing="0.5ex" columnalign="center center center"><mtr><mtd><mn>2</mn></mtd> <mtd><mn>0</mn></mtd> <mtd><mn>0</mn></mtd></mtr> <mtr><mtd><mn>0</mn></mtd> <mtd><mn>1</mn></mtd> <mtd><mn>1</mn></mtd></mtr> <mtr><mtd><mn>0</mn></mtd> <mtd><mn>0</mn></mtd> <mtd><mn>1</mn></mtd></mtr></mtable><mo>)</mo></mrow><mo>,</mo><mspace width="1em"/><mi>P</mi><mo>=</mo><mrow><mo>(</mo><mtable displaystyle="false" rowspacing="0.5ex" columnalign="center center center"><mtr><mtd><mn>1</mn></mtd> <mtd><mn>0</mn></mtd> <mtd><mn>0</mn></mtd></mtr> <mtr><mtd><mn>2</mn></mtd> <mtd><mo lspace="verythinmathspace" rspace="0em">&minus;</mo><mn>1</mn></mtd> <mtd><mn>0</mn></mtd></mtr> <mtr><mtd><mn>3</mn></mtd> <mtd><mn>4</mn></mtd> <mtd><mn>1</mn></mtd></mtr></mtable><mo>)</mo></mrow><mo>,</mo><mspace width="1em"/><mi>A</mi><mo>=</mo><mi>P</mi><mi>J</mi><msup><mi>P</mi> <mrow><mo lspace="verythinmathspace" rspace="0em">&minus;</mo><mn>1</mn></mrow></msup></mrow><annotation encoding='application/x-tex'>J=\left(\begin{array}{ccc}
2 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 1 \\
0 &amp; 0 &amp; 1
\end{array}\right) , \quad
P=\left(\begin{array}{ccc}
1 &amp; 0 &amp; 0 \\
2 &amp; &#x2d;1 &amp; 0 \\
3 &amp; 4 &amp; 1
\end{array}\right), \quad
A=PJP^{&#x2d;1}  </annotation></semantics></math></p><p><div><textarea onkeypress="UI.ckenter(event,this,2)" 
style="width:800px;font-size:large">J:=[[2,0,0],[0,1,1],[0,0,1]]; P:=trn([[1,2,3],[0,-1,4],[0,0,1]]); A:=P*J*inv(P) 
</textarea><button onclick="previousSibling.style.display='inherit';var tmp=UI.caseval(previousSibling.value); tmp=UI.latexeval(tmp);nextSibling.innerHTML=tmp; if (UI.usemathjax) MathJax.Hub.Queue(['Typeset',MathJax.Hub,nextSibling])">ok</button><div style="width:800px;max-height:200px;overflow:auto;color:blue;text-align:center"></div></div>
<br>
<div><textarea onkeypress="UI.ckenter(event,this,2)" 
style="width:800px;font-size:large">D,N:=dunford(A); N^2; P*diag(diag(J))*inv(P) 
</textarea><button onclick="previousSibling.style.display='inherit';var tmp=UI.caseval(previousSibling.value); tmp=UI.latexeval(tmp);nextSibling.innerHTML=tmp; if (UI.usemathjax) MathJax.Hub.Queue(['Typeset',MathJax.Hub,nextSibling])">ok</button><div style="width:800px;max-height:200px;overflow:auto;color:blue;text-align:center"></div></div>
<br>

</p>
<!--TOC subsubsection id="sec12" Slopefield-->
<h4 id="sec12" class="subsubsection">2.4.4  Slopefield</h4><!--SEC END --><p>
This will display the slopefield of an ordinary differential equation
<math xmlns='http://www.w3.org/1998/Math/MathML' display='block'><semantics><mrow><mfrac><mrow><mi>d</mi><mi>y</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo lspace="verythinmathspace" rspace="0em">&minus;</mo><mi>y</mi><mo>+</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding='application/x-tex'>\frac{dy}{dt}=&#x2d;y+cos(t) </annotation></semantics></math>
and one solution corresponding to an initial condition <math xmlns='http://www.w3.org/1998/Math/MathML' display='inline'><semantics><mrow><mi>y</mi><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding='application/x-tex'>y(0)</annotation></semantics></math> that the user may
modify with the slider.


<div><form onsubmit="setTimeout(function(){UI.eval_form(form);});return false;">
<input type="text" name="name" size="1" value=

"y0">

=<input type="number" name="valname" onchange="UI.eval_form(form);" value=

"1.0">

<input type="button" value="-" onclick="valname.value -= stepname.value;UI.eval_form(form);">
<input type="button" value="+" onclick="valname.value -= -stepname.value;UI.eval_form(form);">
<input type="number" name="stepname" value=

"0.1">

<input type="range" name="rangename"
onclick="valname.value=value;UI.eval_form(form);" value=

"1.0" min="-5" max="5" step="0.1">

<textarea name="prog" onchange="UI.eval_form(form)" style="width:400px;vertical-align:bottom;font-size:large">
gl_x=-5..5; gl_y=-3..3;
plotfield(-y+cos(t),[t=-5..5,y=-3..3],xstep=0.4,ystep=0.4);
plotode(-y+cos(t),[t=-5..5,y],[0,y0],tstep=0.1,color=red)


</textarea>
</form>
<span>Not evaled</span></div>

</p>
<!--TOC subsubsection id="sec13" Gröbner basis (CAS)-->
<h4 id="sec13" class="subsubsection">2.4.5  Gröbner basis (CAS)</h4><!--SEC END --><p>
The CAS kernel can compute non-trivial Gröbner basis. Of course,
the JavaScript version is significantly slower than the native Giac/Xcas
kernel.

</p><pre class="verbatim">kat7:=[-x1+2*x8^2+2*x7^2+2*x6^2+2*x5^2+2*x4^2+2*x3^2+2*x2^2+x1^2,
 -x2+2*x8*x7+2*x7*x6+2*x6*x5+2*x5*x4+2*x4*x3+2*x3*x2+2*x2*x1,
 -x3+2*x8*x6+2*x7*x5+2*x6*x4+2*x5*x3+2*x4*x2+2*x3*x1+x2^2,
 -x4+2*x8*x5+2*x7*x4+2*x6*x3+2*x5*x2+2*x4*x1+2*x3*x2,
 -x5+2*x8*x4+2*x7*x3+2*x6*x2+2*x5*x1+2*x4*x2+x3^2,
 -x6+2*x8*x3+2*x7*x2+2*x6*x1+2*x5*x2+2*x4*x3,
 -x7+2*x8*x2+2*x7*x1+2*x6*x2+2*x5*x3+x4^2,
 -1+2*x8+2*x7+2*x6+2*x5+2*x4+2*x3+2*x2+x1]:;
</pre><p> 
<button onclick="var field=parentNode.previousSibling; var tmp=field.innerHTML;if(tmp.length==0) tmp=field.value;var t=createElement('TEXTAREA');t.style.fontSize=20;t.cols=60;t.rows=UI.count_newline(tmp);var tmp1=UI.ltgt(tmp)[0];t.value=tmp1;tmp=UI.caseval(tmp);tmp=UI.rmquote(tmp);nextSibling.innerHTML=tmp; UI.render_canvas(nextSibling); field.parentNode.insertBefore(t,field);field.parentNode.removeChild(field);">ok</button><span>onload</span><br>


Basis over <math xmlns='http://www.w3.org/1998/Math/MathML' display='inline'><semantics><mrow><mi>&Zopf;</mi><mo stretchy="false">/</mo><mn>16777213</mn></mrow><annotation encoding='application/x-tex'>\mathbb{Z}/16777213</annotation></semantics></math>
<div><textarea onkeypress="UI.ckenter(event,this,2)" 
style="width:800px;font-size:large">G:=gbasis(kat7 mod 16777213,[x1,x2,x3,x4,x5,x6,x7,x8]):; size(G); G[20]; 
</textarea><button onclick="previousSibling.style.display='inherit';var tmp=UI.caseval(previousSibling.value); tmp=UI.latexeval(tmp);nextSibling.innerHTML=tmp; if (UI.usemathjax) MathJax.Hub.Queue(['Typeset',MathJax.Hub,nextSibling])">ok</button><div style="width:800px;max-height:200px;overflow:auto;color:blue;text-align:center"></div></div>

Basis over <math xmlns='http://www.w3.org/1998/Math/MathML' display='inline'><semantics><mrow><mi>&Qopf;</mi></mrow><annotation encoding='application/x-tex'>\mathbb{Q}</annotation></semantics></math>
<div><textarea onkeypress="UI.ckenter(event,this,2)" 
style="width:800px;font-size:large">G:=gbasis(kat7,[x1,x2,x3,x4,x5,x6,x7,x8]):; size(G); G[20]; 
</textarea><button onclick="previousSibling.style.display='inherit';var tmp=UI.caseval(previousSibling.value); tmp=UI.latexeval(tmp);nextSibling.innerHTML=tmp; if (UI.usemathjax) MathJax.Hub.Queue(['Typeset',MathJax.Hub,nextSibling])">ok</button><div style="width:800px;max-height:200px;overflow:auto;color:blue;text-align:center"></div></div>
</p>
<!--TOC subsubsection id="sec14" Logo turtle-->
<h4 id="sec14" class="subsubsection">2.4.6  Logo turtle</h4><!--SEC END --><pre class="verbatim">def polyg(n,l):
  for j in range(n):
    avance l
    tourne_gauche 360/n
</pre><p> 
<button onclick="var field=parentNode.previousSibling; var tmp=field.innerHTML;if(tmp.length==0) tmp=field.value;var t=createElement('TEXTAREA');t.style.fontSize=20;t.cols=60;t.rows=UI.count_newline(tmp);var tmp1=UI.ltgt(tmp)[0];t.value=tmp1;tmp=UI.caseval(tmp);tmp=UI.rmquote(tmp);nextSibling.innerHTML=tmp; UI.render_canvas(nextSibling); field.parentNode.insertBefore(t,field);field.parentNode.removeChild(field);">ok</button><span>onload</span><br>



</p><pre class="verbatim">efface;
for n in range(3,11):
  polyg(n,20)
</pre><p> 
<button onclick="var field=parentNode.previousSibling; var tmp=field.innerHTML;if(tmp.length==0) tmp=field.value;var t=createElement('TEXTAREA');t.style.fontSize=16;t.cols=60;t.rows=10;var tmp1=UI.ltgt(tmp);t.value=tmp1[0];tmp=UI.caseval(tmp);tmp=UI.rmquote(tmp);nextSibling.innerHTML=tmp; UI.render_canvas(nextSibling); field.parentNode.insertBefore(t,field);field.parentNode.removeChild(field);">ok</button><span></span><br>



<textarea onkeypress="UI.ckenter(event,this,1)" 
style="width:400px;font-size:large">
efface;
for n from 3 to 10 do polyg(n,20) od;

</textarea><button onclick="previousSibling.style.display='inherit';var tmp=UI.caseval(previousSibling.value);tmp=UI.rmquote(tmp); nextSibling.innerHTML='&nbsp;'+tmp;UI.render_canvas(nextSibling);">ok</button><span></span><br>
</p>
<!--TOC subsubsection id="sec15" Fractals-->
<h4 id="sec15" class="subsubsection">2.4.7  Fractals</h4><!--SEC END --><pre class="verbatim">def fra1(X,Y,Nmax):
  w=2.7/X
  h=-1.87/Y
  res1=makelist(-ceil(X*Y/2)-1)
  res2=copy(res1)
  Y=Y-1
  for y in range(ceil(Y/2)+1):
    c = -2.1+i*(h*y+0.935)
    for x in range(X):
      z = 0
      for j in range(Nmax):
        if abs(z=z**2+c)&gt;2:
           break
      res1.append(pixon(x,y,5100*j+512))
      res2.append(pixon(x,Y-y,5100*j+512))
      c = c+w;
  return res1,res2
</pre><p> 
<button onclick="var field=parentNode.previousSibling; var tmp=field.innerHTML;if(tmp.length==0) tmp=field.value;var t=createElement('TEXTAREA');t.style.fontSize=20;t.cols=60;t.rows=UI.count_newline(tmp);var tmp1=UI.ltgt(tmp)[0];t.value=tmp1;tmp=UI.caseval(tmp);tmp=UI.rmquote(tmp);nextSibling.innerHTML=tmp; UI.render_canvas(nextSibling); field.parentNode.insertBefore(t,field);field.parentNode.removeChild(field);">ok</button><span>onload</span><br>



<textarea onkeypress="UI.ckenter(event,this,1)" 
style="width:400px;font-size:large">axes=0;pixon(1);fra1(160,160,10)
</textarea><button onclick="previousSibling.style.display='inherit';var tmp=UI.caseval(previousSibling.value);tmp=UI.rmquote(tmp); nextSibling.innerHTML='&nbsp;'+tmp;UI.render_canvas(nextSibling);">ok</button><span></span><br>
</p>
<!--TOC section id="sec16" How this is done-->
<h2 id="sec16" class="section">3  How this is done</h2><!--SEC END --><p>
The L<sup>A</sup>T<sub>E</sub>X <code>\giac...</code> commands are defined in <code>giac.tex</code>.
For example <code>\giacinput</code> is defined like this:
</p><pre class="verbatim">\newcommand{\giacinput}[2][style="width:400px;font-size:large"]{
\ifhevea
\@print{&lt;textarea onkeypress="UI.ckenter(event,this,1)" }
\@getprint{#1&gt;#2}
\@print{&lt;/textarea&gt;&lt;button onclick="previousSibling.style.display='inherit';var tmp=UI.caseval(previousSibling.value);tmp=UI.rmquote(tmp); nextSibling.innerHTML='&amp;nbsp;'+tmp;UI.render_canvas(nextSibling);"&gt;ok&lt;/button&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;}
\else
\lstinline@#2@
\fi
}
</pre><p>
If <code>hevea</code> compiles the command, the <code>\ifhevea</code> part is
active, and the command will output an HTML5 <code>&lt;textarea&gt;</code> element
and a OK <code>&lt;button&gt;</code>, with a callback to JavaScript code
that will evaluate the CAS command inside the textarea <br>
<code>var tmp=UI.caseval(previousSibling.value)</code><br>
and fill the next HTML5 <code>&lt;span&gt;</code> field with the result of the CAS
command.</p><p>The CAS evaluation is performed by a call to <code>giaceval</code> in the
<code>UI.caseval</code> code (defined in <code>giac.tex</code>), where
<code>giaceval</code> is a global JavaScript variable assigned at page load-time
from the <code>Module</code> interface created by compiling Giac/Xcas with
the C++ to JavaScript compiler 
<a href="http://kripken.github.io/emscripten-site/"><span style="font-family:monospace">emscripten</span></a>. 
The CAS code being in JavaScript, it can be run on every
JavaScript-enabled browser. It will be faster on browsers that have
support for <code>asm.js</code> (<code>asmjs.org</code>) 
like Mozilla Firefox: numerical computations
are 1 to 2 times slower than native code, while exact computations
are 2 to 10 times slower than native code (the main reason being that
JavaScript has currently no 64 bits integer type).</p><p>For a PDF output, if <code>pdflatex</code> is run on the tex file,
giac commands will be written verbatim, but they will not be processed.
The <code>icas</code> command from the Giac/Xcas package will filter all
giac commands, process them and output the result in math mode in a
temporary L<sup>A</sup>T<sub>E</sub>X file. If the
answer is a 2-d graph output, <code>icas</code> will output a pdf file on
the hard disk and output a corresponding <code>\includegraphics</code>
command in the temporary L<sup>A</sup>T<sub>E</sub>X file. After that, the temporary file 
will be processed by <code>pdflatex</code>.</p>
<!--TOC section id="sec17" Conclusion-->
<h2 id="sec17" class="section">4  Conclusion</h2><!--SEC END --><p>
The current version of <code>icas</code> and <code>giac.tex</code> are already
usable to easily produce HTML interactive CAS-enabled document from 
L<sup>A</sup>T<sub>E</sub>X documents. They may be completed in future versions depending
on user requests. For example, online courses might have commands to
enable student exercises answers auto-check.</p><p><span style="font-weight:bold">Acknowledgements</span> <br>
Thanks to Luc Maranget and Yannick Chevalier for fixing bugs in
mathjax-enabled hevea. 
Thanks to Renée De Graeve and Murielle Stepec who have tested
preliminary versions of this compilation method.</p><p>

</div>
<div id="controldiv" style="max-height: 400px; overflow:auto">
<span id="controlindex"></span>
<button title="Clone last command to Xcas on line" onclick="UI.clone()">Clone</button>
<button title="Clear console" onclick="document.getElementById('output').innerHTML='';">Clear</button>
<button title="Increase console size" onclick="var field=document.getElementById('output'); var s=field.style.maxHeight; s=s.substr(0,s.length-2);s=eval(s)+20 ;if(s<innerHeight/2){s=s+'px';field.style.maxHeight=s; field=document.getElementById('maindiv'); s=field.style.maxHeight; s=s.substr(0,s.length-2);s=eval(s)-20; s=s+'px';field.style.maxHeight=s;}">+</button>
<button title="Decrease console size" onclick="var field=document.getElementById('output'); var s=field.style.maxHeight; s=s.substr(0,s.length-2);s=eval(s)-20 ; if(s>80){s=s+'px';field.style.maxHeight =s;field=document.getElementById('maindiv'); s=field.style.maxHeight; s=s.substr(0,s.length-2);s=eval(s)+20; s=s+'px';field.style.maxHeight=s;}">-</button>
<textarea title="Commandline for a quick computation" onkeypress="UI.ckenter(event,this,3);" style="width:400px;height:20px;font-size:large"></textarea><button  title="Eval previous cell" onclick="UI.quick(this);">-></button><span></span>
&nbsp;&nbsp;<button onclick="var s=UI.caseval('restart;'); Module.print(s);" title="Reset CAS computing kernel">Restart</button>
<button onclick="UI.exec(document.documentElement);" title='Click here to exec all commands (maybe be long!)'>Exec. all</button>
<canvas id='canvas' width=0 height=0   onmousedown="UI.canvas_pushed=true;UI.canvas_lastx=event.clientX; UI.canvas_lasty=event.clientY;"  onmouseup="UI.canvas_pushed=false;" onmousemove="UI.canvas_mousemove(event,'')"></canvas>
<div id="output" style="max-height: 80px; overflow:auto"></div>
</div>
</div>


<script language="javascript"> 
var Module = { 
        htmlcheck:true,
        htmlbuffer:'',
        preRun: [],
        postRun: [],
        ready:false,
        print: (function() {
          var element = document.getElementById('output');
          element.innerHTML='';// element.value = ''; // clear browser cache
          return function(text) {
            //console.log(text.charCodeAt(0));
            if (text.length==1 && text.charCodeAt(0)==12){ element.innerHTML=''; return; }
            if (text.length>=1 && text.charCodeAt(0)==2) {console.log('STX');Module.htmlcheck=false; htmlbuffer='';return;}
            if (text.length>=1 && text.charCodeAt(0)==3) {console.log('ETX');Module.htmlcheck=true; element.style.display='inherit'; element.innerHTML += htmlbuffer;htmlbuffer='';element.scrollTop = 99999; return;}
            if (Module.htmlcheck){
            // These replacements are necessary if you render to raw HTML 
             text = text.replace(/&/g, "&amp;");
             text = text.replace(/</g, "&lt;");
             text = text.replace(/>/g, "&gt;");
             text = text.replace('\n', '<br>', 'g');
             text += '<br>'
             element.style.display='inherit';
             element.innerHTML += text; // element.value += text + "\n";
             element.scrollTop = 99999; // focus on bottom
            } else htmlbuffer += text;
          };
        })(),
     canvas: document.getElementById('canvas'),};
Module['onRuntimeInitialized']=function(){ console.log('UI is ready'); Module.ready=true;}
</script>



<script async>
  var UI={
   detectmob:function() { 
    if( navigator.userAgent.match(/Android/i)
	|| navigator.userAgent.match(/webOS/i)
	|| navigator.userAgent.match(/iPhone/i)
	|| navigator.userAgent.match(/iPad/i)
	|| navigator.userAgent.match(/iPod/i)
	|| navigator.userAgent.match(/BlackBerry/i)
	|| navigator.userAgent.match(/Windows Phone/i)
      ) return true;
    else 
      return false;
   },
   readCookie:function(name) {
    if (window.localStorage){
      var tmp=localStorage.getItem(name);
      if (tmp!=null) return tmp;
    }
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
      var c = ca[i];
      while (c.charAt(0)==' ') c = c.substring(1,c.length);
      if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
   },
  }
  var script = document.createElement("script");
  script.type = "text/javascript";
  var webAssemblyAvailable = false;
  if (Boolean(window.chrome)){
    if (!UI.detectmob()) webAssemblyAvailable =  window.location.href.substr(0,4)!='file';
  }
  else {
    var ua = window.navigator.userAgent;
    var old_ie = ua.indexOf('MSIE ');
    var new_ie = ua.indexOf('Trident/');
    if (!UI.detectmob() && old_ie<=-1 && new_ie<=-1)
      webAssemblyAvailable =!!window.WebAssembly;
  }
  if (webAssemblyAvailable){
    var ck=UI.readCookie('xcas_wasm');
    if (ck)
      webAssemblyAvailable=(ck=='1');
  }
  if (webAssemblyAvailable) // fixme: enable
    script.src =""+"giacwasm.js";
  else
    script.src  =""+"giac.js";
  document.getElementsByTagName("head")[0].appendChild(script);
</script>




<script language="javascript"> 
 var UI = {
  n2d:0,
  histcount:0,
  usemathjax:false,
  lastcmd:'',
  clone:function(){
    if (UI.lastcmd.length){
       var tmp=UI.giaceval('VARS(-1)');
       tmp=encodeURIComponent(tmp);
       var url='https://www-fourier.ujf-grenoble.fr/~parisse/xcasen.html#+'+tmp+':;&+'+UI.lastcmd;
       console.log(url);
       window.open(url,'_blank');
    }
  },
  canvas_pushed:false,
  canvas_lastx:0,
  canvas_lasty:0,
  canvas_mousemove:function(event,no){
    if (UI.canvas_pushed){
      // Module.print(event.clientX);
      if (UI.canvas_lastx!=event.clientX){
        if (event.clientX>UI.canvas_lastx)
          giac3d('r'+no);
        else
          giac3d('l'+no);
        UI.canvas_lastx=event.clientX;
      }
      if (UI.canvas_lasty!=event.clientY){
        if (event.clientY>UI.canvas_lasty)
          giac3d('d'+no);
        else
          giac3d('u'+no);
        UI.canvas_lasty=event.clientY;
      }
    }
  },  
  count_newline:function(s){
    var ss=s.length,i,res=1;
    for (i=0;i<ss;i++){
      if (s[i]=='\n') res++;
    }
    return res;
  },
  ltgt:function(s){
    var ss=s.length,i,res='',c=0;
    for (i=0;i<ss-4;i++){
      if (s[i]=='\n') c++;      
      if (s[i]!='&' || s[i+2]!='t' || s[i+3]!=';'){
        res += s[i];
        continue;
      }
      if (s[i+1]=='l'){
        res += '<';
        i +=3;
        continue;
      }
      if (s[i+1]=='g'){
        res += '>';
        i +=3;
        continue;
      }
      res += s[i];
    }
    for (;i<ss;i++) res+=s[i];
    return [res,c];
  },
  rmquote:function(tmp){
    var s=tmp.length;
    if (s>2 && tmp.charCodeAt(0)==34 && tmp.charCodeAt(s-1)==34)
      tmp=tmp.substr(1,s-2);
    return tmp;
  },
  renderhelp: function (s) {
    var pos0 = s.search("</b>");
    //console.log(s);
    var found = (s.substr(pos0 + 7, 20) != "Best match has score");
    var lh = s.substr(3, pos0 - 3);
    var unlocalized_cmd = lh;
    var sorig = s;
    pos1 = s.search("<br>");
    if (pos1 < 0) return sorig;
    var explication = s.substr(0, pos1);
    s = s.substr(pos1 + 4, s.length - pos1 - 4);
    pos1 = s.search("<br>");
    if (pos1 < 0) return sorig;
    var syntaxe = s.substr(0, pos1);
    s = s.substr(pos1 + 4, s.length - pos1 - 4);
    pos1 = s.search("<br>");
    if (pos1 < 0) return sorig;
    var voiraussi = s.substr(0, pos1);
    var examples = s.substr(pos1 + 4, s.length - pos1 - 4);
    s = '';//'<b>'+unlocalized_cmd+':</b> ';
    if (found)
      s += explication + '<br>See also: ' +voiraussi+'<br><b>Examples : </b>'+examples;
    else
      s += explication.substr(0, pos0);
    return s;
  },   
  quick:function(field){
    var tmp1=field.previousSibling.value;
    var tmp=UI.caseval(tmp1);
    tmp=UI.rmquote(tmp); 
    tmp=UI.latexeval(tmp);
    Module.print(String.fromCharCode(2));
    Module.print("<tt>");
    Module.print(tmp1);
    Module.print("</tt><br>&nbsp;&nbsp;");
    if (tmp.length>3 && tmp.substr(0,3)=='<b>'){ 
       Module.print(UI.renderhelp(tmp)); tmp='';
    } else Module.print(tmp);
    Module.print("<br>");
    Module.print(String.fromCharCode(3));
    field.nextSibling.innerHTML='&nbsp;'+tmp;
   //UI.render_canvas(nextSibling);  
  },
  giaceval:function(text){
     if (!Module.ready){ window.setTimeout(UI.giaceval,100,text); return " ... ";}
     var dogiaceval=Module.cwrap('caseval',  'string', ['string']);
     return dogiaceval(text);
  },
  caseval:function(text){
    UI.lastcmd=text;
    var s="not evaled",err;
    try {
       s= UI.giaceval(text);
    } catch (err) { s=err.message;}
    var is_2d=s.length>4 && s.substr(0,4)=='gr2d';
    if (is_2d){
      s = '<canvas id="gr2d_'+UI.n2d+'" width=400 height=250>'+s+'</canvas>';
      //console.log(UI.n2d,s);
      UI.n2d++;
    }
    var is_3d=s.length>5 && s.substr(0,5)=='gl3d ';
    if (is_3d){
	var n3d=s.substr(5,s.length-5);
	s = '<canvas id="gl3d_'+n3d+'" onmousedown="UI.canvas_pushed=true;UI.canvas_lastx=event.clientX; UI.canvas_lasty=event.clientY;" onmouseup="UI.canvas_pushed=false;" onmousemove="UI.canvas_mousemove(event,'+n3d+')" width=400 height=250></canvas>';
    }
   //console.log(s);
    return s;
  },
  pourcentmod:function(a,b){
    return a-Math.floor(a/b)*b;
  },
  color_list: ['black',
    'red',
    'green',
    'yellow',
    'blue',
    'magenta',
    'cyan',
    'white',
    'silver',
    'gray',
    'maroon',
    'purple',
    'fuchsia',
    'lime',
    'olive',
    'navy',
    'teal',
    'aqua',
    'antiquewhite',
    'aquamarine',
    'azure',
    'beige',
    'bisque',
    'blanchedalmond',
    'blueviolet',
    'brown',
    'burlywood',
    'cadetblue',
    'chartreuse',
    'chocolate',
    'coral',
    'cornflowerblue',
    'cornsilk',
    'crimson',
    'cyan',
    'darkblue',
    'darkcyan',
    'darkgoldenrod',
    'darkgray',
    'darkgreen',
    'darkgrey',
    'darkkhaki',
    'darkmagenta',
    'darkolivegreen',
    'darkorange',
    'darkorchid',
    'darkred',
    'darksalmon',
    'darkseagreen',
    'darkslateblue',
    'darkslategray',
    'darkslategrey',
    'darkturquoise',
    'darkviolet',
    'deeppink',
    'deepskyblue',
    'dimgray',
    'dimgrey',
    'dodgerblue',
    'firebrick',
    'floralwhite',
    'forestgreen',
    'gainsboro',
    'ghostwhite',
    'gold',
    'goldenrod',
    'greenyellow',
    'grey',
    'honeydew',
    'hotpink',
    'indianred',
    'indigo',
    'ivory',
    'khaki',
    'lavender',
    'lavenderblush',
    'lawngreen',
    'lemonchiffon',
    'lightblue',
    'lightcoral',
    'lightcyan',
    'lightgoldenrodyellow',
    'lightgray',
    'lightgreen',
    'lightgrey',
    'lightpink',
    'lightsalmon',
    'lightseagreen',
    'lightskyblue',
    'lightslategray',
    'lightslategrey',
    'lightsteelblue',
    'lightyellow',
    'limegreen',
    'linen',
    'mediumaquamarine',
    'mediumblue',
    'mediumorchid',
    'mediumpurple',
    'mediumseagreen',
    'mediumslateblue',
    'mediumspringgreen',
    'mediumturquoise',
    'mediumvioletred',
    'midnightblue',
    'mintcream',
    'mistyrose',
    'moccasin',
    'navajowhite',
    'oldlace',
    'olivedrab',
    'orangered',
    'orchid',
    'palegoldenrod',
    'palegreen',
    'paleturquoise',
    'palevioletred',
    'papayawhip',
    'peachpuff',
    'peru',
    'pink',
    'plum',
    'powderblue',
    'rosybrown',
    'royalblue',
    'saddlebrown',
    'salmon',
    'sandybrown',
    'seagreen',
    'seashell',
    'sienna',
    'skyblue',
    'slateblue',
    'slategray',
    'slategrey',
    'snow',
    'springgreen',
    'steelblue',
    'tan',
    'thistle',
    'tomato',
    'turquoise',
    'violet',
    'wheat',
    'whitesmoke',
    'yellowgreen'],
  arc_en_ciel: function (k) {
    var r, g, b;
    k += 21;
    k = pourcentmod(k,126);
    if (k < 0)
      k += 126;
    if (k < 21) {
      r = 251;
      g = 0;
      b = 12 * k;
    }
    if (k >= 21 && k < 42) {
      r = 251 - (12 * (k - 21));
      g = 0;
      b = 251;
    }
    if (k >= 42 && k < 63) {
      r = 0;
      g = (k - 42) * 12;
      b = 251;
    }
    if (k >= 63 && k < 84) {
      r = 0;
      g = 251;
      b = 251 - (k - 63) * 12;
    }
    if (k >= 84 && k < 105) {
      r = (k - 84) * 12;
      g = 251;
      b = 0;
    }
    if (k >= 105 && k < 126) {
      r = 251;
      g = 251 - (k - 105) * 12;
      b = 0;
    }
    return 'rgb(' + r + ',' + g + ',' + b + ')';
  },
  turtle_color: function (c) {
    if (c >= 0x100) {
      if (c < 0x17e)
        return UI.arc_en_ciel(c);
      return 'rgb(' + Math.floor(c / (256 * 256)) + ',' + UI.pourcentmod(Math.floor(c / 256), 256) + ',' + UI.pourcentmod(c ,256) + ')';
    }
    return UI.color_list[c];
  },
  pixon_draw: function (id, s) {
    var v = eval(s);
    if (!Array.isArray(v)) return;
    //console.log(v[0], v.length);
    var canvas = document.getElementById(id);
    var l = v.length, w = 0, h = 0;
    if (l < 2) return;
    var scale = v[0];
    for (var k = 1; k < l; k++) {
      var cur = v[k];
      var x = cur[0], y = cur[1];
      if (cur.length==3 && typeof cur[2]!="number"){
	x+=100;
	y+=16;
      }
      if (cur.length==4) {
        var tmp = cur[3];
	if (typeof tmp=="number"){
          if (tmp > 0) y += tmp; else x -= tmp;
	} else {
	  x+=100;
	  y+=16;
	}
      }
      //console.log(cur,x,y);
      if (x > w) w = x;
      if (y > h) h = y;
    }
    w = (w + 1) * scale;
    h = (h + 1) * scale;
    canvas.width = w;
    canvas.height = h;
    //console.log(h,w);
    if (canvas.getContext) {
      var ctx = canvas.getContext('2d');
      for (var k = 1; k < l; k++) {
        var cur = v[k], cl;
        //console.log(cur);
        if (!Array.isArray(cur) || (cl = cur.length) < 2) continue;
        // cur[0]=x, cur[1]=y, cur[2]=color, cur[3]=w if +, h if -
        var x = cur[0] * scale;
        var y = cur[1] * scale;
	if (cl>2 && typeof cur[2]=="string"){
	  console.log(cur[2]);
	  ctx.font = '16px serif';
	  ctx.fillStyle = 'black';
	  ctx.fillText(cur[2],x,y+16,100);
	  continue;
	}
        ctx.fillStyle = (cl > 2) ? UI.turtle_color(cur[2]) : 'black';
        if (cl < 4) {
          ctx.fillRect(x, y, scale, scale);
          continue;
        }
	if (typeof cur[3]=="string"){
	  ctx.font = '16px serif';
	  ctx.fillText(cur[3],x,y+16,100);
	  continue;
	}
        var h = cur[3] * scale, w = scale;
        if (h < 0) {
          w = -h;
          h = scale;
        }
        ctx.fillRect(x, y, w, h);
      }
    }
  },
  turtle_dx: 0, // shift frame
  turtle_dy: 0,
  turtle_z: 1,  // zoom factor
  turtle_maillage: 1,
  turtle_draw: function (id, s) {
    if (s.length < 7) return;
    s = s.substr(5, s.length - 6);
    if (s.length > 7 && s.substr(s, 6) == "pixon(") {
      UI.pixon_draw(id, s.substr(6, s.length - 7));
      return;
    }
    if (s.length < 6 || s.substr(s, 5) != "logo(")
      return;
    s = s.substr(5, s.length - 6);
    //console.log(s);
    var v = eval(s);
    if (!Array.isArray(v)) return;
    //console.log(v[0]);
    var canvas = document.getElementById(id);
    var w = canvas.width, h = canvas.height;
    if (canvas.getContext) {
      var ctx = canvas.getContext('2d');
      var turtlezoom = UI.turtle_z, turtlex = UI.turtle_dx, turtley = UI.turtle_dy;
      // maillage
      if (UI.turtle_maillage & 3) {
        ctx.fillStyle = 'black';
        var xdecal = Math.floor(turtlex / 10.0) * 10;
        var ydecal = Math.floor(turtley / 10.0) * 10;
        if ((UI.turtle_maillage & 0x3) == 1) {
          for (var i = xdecal; i < w + xdecal; i += 10) {
            for (var j = ydecal; j < h + ydecal; j += 10) {
              var X = Math.floor((i - turtlex) * turtlezoom + .5);
              var Y = Math.floor((j - turtley) * turtlezoom + .5);
              // console.log(X,Y);
              ctx.fillRect(X, h - Y, 1, 1);
            }
          }
        } else {
          var dj = Math.sqrt(3.0) * 10, i0 = xdecal;
          for (var j = ydecal; j < h + ydecal; j += dj) {
            var J = Math.floor(h - (j - turtley) * turtlezoom);
            for (var i = i0; i < w + xdecal; i += 10) {
              ctx.fillRect(Math.floor((i - turtlex) * turtlezoom + .5), J, 1, 1);
            }
            i0 += dj;
            while (i0 >= 10)
              i0 -= 10;
          }
        }
      }
      var l = v.length, i;
      // montre la position et le cap (v[l-1])
      var prec = v[l - 1];
      ctx.font = '16px serif';
      ctx.fillStyle = 'yellow';
      ctx.fillRect(w - 40, 0, 40, 50);
      ctx.fillStyle = 'black';
      ctx.fillText('x:' + prec[0], w - 40, 15);
      ctx.fillText('y:' + prec[1], w - 40, 31);
      ctx.fillText('t:' + prec[2], w - 40, 49);
      // v[i]=[x(0),y(1),cap(2),status(3),r(4),chaine(5)],
      // couleur=status >> 11
      // longueur_tortue= (status>>3)&0xff
      // direct=status&4 (vrai si angle dans le sens trigo)
      // visible=status&2
      // crayon baisse=status&1
      // si r>0 arc/disque rayon=r & 0x1ff, theta1=(r >> 9) & 0x1ff, theta2=(r >> 18) & 0x1ff
      //        rempli=(r>>27)&0x1
      // si r<0 ligne polygonale extremite v[i] origine v[i+r] (r<0)
      for (k = 1; k < l; k++) {
        prec = v[k - 1];
        var cur = v[k];
        var preccouleur = prec[3] >> 11; // -> FIXME colors
        var curcouleur = prec[3] >> 11; // -> FIXME colors
        if (cur[5].length) {
          ctx.font = cur[4] + 'px serif';
          ctx.strokeStyle = ctx.fillStyle = UI.turtle_color(curcouleur);
          ctx.fillText(cur[5], turtlezoom * (cur[0] - turtlex), h - turtlezoom * (cur[1] - turtley));
          continue;
        }
        var radius = cur[4], precradius = prec[4];
        var x1 = Math.floor(turtlezoom * (prec[0] - turtlex) + .5),
            y1 = Math.floor(turtlezoom * (prec[1] - turtley) + .5),
            x2 = Math.floor(turtlezoom * (cur[0] - turtlex) + .5),
            y2 = Math.floor(turtlezoom * (cur[1] - turtley) + .5);
        if (radius > 0) {
          var r = radius & 0x1ff, theta1, theta2, rempli, x, y, R, angle;
          theta1 = prec[2]+ ((radius >> 9) & 0x1ff);
          theta2 = prec[2] + ((radius >> 18) & 0x1ff);
          rempli = (radius >> 27) & 1;
	  var seg = (radius >> 28) & 1;
          R = Math.floor(turtlezoom * r + .5);
          angle1 = Math.PI / 180 * (theta1 - 90);
          angle2 = Math.PI / 180 * (theta2 - 90);
          x = Math.floor(turtlezoom * (cur[0] - turtlex - r * Math.cos(angle2)) + .5);
          y = Math.floor(turtlezoom * (cur[1] - turtley - r * Math.sin(angle2)) + .5);
          ctx.beginPath();
	  if (seg)
            ctx.moveTo(x2, h - y2);
	  else {
            ctx.moveTo(x, h - y);
            ctx.lineTo(x2, h - y2);
	  }
	  //console.log(x,y,x1,y1,angle1,angle2);
          ctx.arc(x, h - y, R, -angle2,-angle1);
          ctx.closePath();
          ctx.strokeStyle = ctx.fillStyle = UI.turtle_color(curcouleur);
          if (rempli)
            ctx.fill();
          else
            ctx.stroke();
          continue;
        }
        if (prec[3] & 1) {
          ctx.strokeStyle = ctx.fillStyle = UI.turtle_color(preccouleur);
          ctx.beginPath();
          ctx.moveTo(x1, h - y1);
          ctx.lineTo(x2, h - y2);
          ctx.closePath();
          ctx.stroke();
        }
        if (radius < -1 && k + radius >= 0) {
          ctx.strokeStyle = ctx.fillStyle = UI.turtle_color(curcouleur);
          ctx.beginPath();
          var x0 = Math.floor(turtlezoom * (cur[0] - turtlex) + .5), y0 = Math.floor(turtlezoom * (cur[1] - turtley) + .5);
          //console.log('begin',x0,y0);
          ctx.moveTo(x0, h - y0);
          for (var i = -1; i >= radius; i--) {
            prec = v[k + i];
            var x = Math.floor(turtlezoom * (prec[0] - turtlex) + .5);
            var y = Math.floor(turtlezoom * (prec[1] - turtley) + .5);
            //console.log(i,x,y);
            ctx.lineTo(x, h - y);
          }
          //console.log('end',x0,y0);
          //ctx.lineTo(x0,h-y0);
          ctx.closePath();
          ctx.fill(); // automatically close path
        }
      }
      var cur = v[l - 1];
      if (cur[3] & 2) {
        // dessin de la tortue
        var x = Math.floor(turtlezoom * (cur[0] - turtlex) + .5);
        var y = Math.floor(turtlezoom * (cur[1] - turtley) + .5);
        var cost = Math.cos(cur[2] * Math.PI / 180);
        var sint = Math.sin(cur[2] * Math.PI / 180);
        var turtle_length = (cur[3] >> 3) & 0xff;
        var Dx = Math.floor(turtlezoom * turtle_length * cost / 2 + .5);
        var Dy = Math.floor(turtlezoom * turtle_length * sint / 2 + .5);
        //console.log('tortue',cur,w,h,turtlezoom,x,y,Dx,Dy);
        ctx.strokeStyle = ctx.fillStyle = UI.turtle_color(curcouleur);
        ctx.beginPath();
        ctx.moveTo(x + Dy, h - (y - Dx));
        ctx.lineTo(x - Dy, h - (y + Dx));
        ctx.closePath();
        ctx.stroke();
        if (!(cur[3] & 1))
          ctx.strokeStyle = ctx.fillStyle = UI.turtle_color(curcouleur + 1);
        ctx.beginPath();
        ctx.moveTo(x + Dy, h - (y - Dx));
        ctx.lineTo(x + 3 * Dx, h - (y + 3 * Dy));
        ctx.closePath();
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x - Dy, h - (y + Dx));
        ctx.lineTo(x + 3 * Dx, h - (y + 3 * Dy));
        ctx.closePath();
        ctx.stroke();
      }
    }
  },
  render_canvas:function(field){
   var n=field.id;
   if (n && n.length>4 && n.substr(0,4)=='gr2d'){
     var s=field.innerHTML;
     //console.log(s);
     UI.turtle_draw(n, s);
   }
   if (n && n.length>5 && n.substr(0,5)=='gl3d_'){
    Module.print(n);
    var n3d=n.substr(5,n.length-5);
    giac3d(n3d);
    return;
   }
   var f=field.firstChild;
   for (;f;f=f.nextSibling){
     UI.render_canvas(f);
   }
  },
  eval_form: function(field){
    UI.giaceval('assume('+field.name.value+'=round('+field.valname.value+',12))');
    var s=UI.caseval(field.prog.value);
    var is_svg=s.substr(1,4)=='<svg';
    if (is_svg) field.parentNode.lastChild.innerHTML=s.substr(1,s.length-2);
    else field.parentNode.lastChild.innerHTML=s;
   UI.render_canvas(field.parentNode.lastChild);
  },
  latexeval:function(text){
    var tmp=text;
    if (tmp.length>10 && tmp.substr(0,10)=='GIAC_ERROR') return '"'+tmp.substr(11,tmp.length-11)+'"';
    if (tmp.length>5 && tmp.substr(0,5)=='gl3d_') return tmp;
    if (tmp.length>5 && tmp.substr(1,4)=='<svg') return tmp.substr(1,tmp.length-2);
    if (tmp.length>5 && tmp.substr(0,4)=='<svg') return tmp;
    if (tmp.length>3 && tmp.substr(0,3)=='<b>') return tmp;
     if (UI.usemathjax){
       tmp=UI.giaceval('latex(quote('+tmp+'))');
       var dollar=String.fromCharCode(36);
       tmp=dollar+dollar+tmp.substr(1,tmp.length-2)+dollar+dollar;
       return tmp;
     }
     tmp=UI.giaceval('mathml(quote('+tmp+',1))');
     tmp=tmp.substr(1,tmp.length-2);
    return tmp;   
  },
  ckenter:function(event,field,mode){
    var key = event.keyCode;
    if (key != 13 || event.shiftKey) return true;
   if (mode==3){ UI.quick(field.nextSibling); event.preventDefault(); field.select(); return true; }
    var tmp=field.value;
   Module.print(tmp);
    tmp=UI.caseval(tmp);
    if (mode==1){
      tmp=UI.rmquote(tmp); 
   }
   if (mode==2){
     tmp=UI.latexeval(tmp);
   }
   field.nextSibling.nextSibling.innerHTML=tmp;
   UI.render_canvas(field.nextSibling.nextSibling);
   if (UI.usemathjax) MathJax.Hub.Queue(["Typeset",MathJax.Hub,field.nextSibling.nextSibling]);
   if (event.preventDefault) event.preventDefault();
    return false;
  },
   exec: function(field){
     if (field.nodeName=="BUTTON" && field.innerHTML!='Clone' && field.innerHTML!='Restart' && field.innerHTML!='Exec. all'){
        field.click();
        return;
     }
     if (field.nodeName=="FORM"){
        UI.eval_form(field);
        return;
     }
     var f=field.firstChild;
     while (f){
       UI.exec(f);
       f=f.nextSibling;
     }
   },
  execonload: function(field){
     var f=field.nextSibling;
     if (f && f.innerHTML=="onload" && field.nodeName=="BUTTON"){
        field.click();
        return;
     }
     f=field.firstChild;
     while (f){
       UI.execonload(f);
       f=f.nextSibling;
     }
   },
  textarealtgt: function(field){
     if (field.nodeName=="TEXTAREA"){
        var tmp=UI.ltgt(field.value);
        field.value=tmp[0];
        //field.style.height=20*(tmp[1]+1)+'px';
        field.rows=tmp[1]+1;
        return;
     }
     var f=field.firstChild;
     while (f){
       UI.textarealtgt(f);
       f=f.nextSibling;
     }
   }
 };
 window.onload = function(e){
   var isFirefox = typeof InstallTrigger !== 'undefined';   // Firefox 1.0+
   var isSafari = Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor') > 0;
  var ua = window.navigator.userAgent;
  var old_ie = ua.indexOf('MSIE ');
  var new_ie = ua.indexOf('Trident/');
  if ((!isFirefox && !isSafari) || (old_ie > -1) || (new_ie > -1) || window.chrome){
     UI.usemathjax=true;
     alert("Your browser does not support MathML, using MathJax for 2d rendering. Consider switching to Firefox for better rendering and faster results");
  }
  if (UI.usemathjax){
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  }
  var elem= document.getElementById('controlindex');
  elem.innerHTML='<hr><a href="'+String.fromCharCode(35)+'sec1">Table</a>, <a href="'+String.fromCharCode(35)+'sec2">Index</a>,'+elem.innerHTML;
  if (elem.style.maxHeight=='500px')
    elem.style.maxHeight=(window.innerHeight-120)+'px';
  elem= document.getElementById('maindiv');
  elem.style.maxHeight=(window.innerHeight-150)+'px';
  // Module.print(elem.innerHTML);
  //elem.parentNode.insertBefore(elem,null);
  giac3d = Module.cwrap('_ZN4giac13giac_rendererEPKc','number', ['string']);
  UI.giaceval('set_language(1);');
  //UI.giaceval('factor(x^4-1)');
  //UI.giaceval('sin(x+y)+f(t)');
  UI.textarealtgt(document.documentElement);
  UI.execonload(document.documentElement);
  document.getElementById('output').innerHTML='';
 // if (confirm('Exec commands?')) UI.exec(document.documentElement);
 };
</script>


</p><!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<hr style="height:2"></body>
</html>
